<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ClassBuddy - Offline Schedule</title>

<!-- PWA and SEO Meta Tags -->
<meta name="description" content="Your intelligent class schedule assistant, always available offline.">
<meta name="theme-color" content="#f5f5f7" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#121212" media="(prefers-color-scheme: dark)">
<link rel="manifest" href="manifest.json">
<link rel="icon" href="icon.svg" type="image/svg+xml">
<link rel="apple-touch-icon" href="icon.svg">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="ClassBuddy">

<script src="https://cdn.tailwindcss.com"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@400;500;700&display=swap');
:root {
--bg-main: #f5f5f7;
--bg-card: #ffffff;
--bg-alt: #e5e5ea;
--text-primary: #1d1d1f;
--text-secondary: #86868b;
--accent-primary: #007AFF;
--accent-rgb: 0, 122, 255;
--accent-primary-hover: #0062CC;
--text-on-accent: #ffffff;
--border-color: #d1d1d6;
--bg-badge: #eef2ff;
--text-badge: #4338ca;
--timeline-indicator: #dc2626; /* Red for high visibility */
}
.dark {
--bg-main: #121212;
--bg-card: #1d1d1d;
--bg-alt: #2c2c2e;
--text-primary: #ffffff;
--text-secondary: #8e8e93;
--accent-primary: #0A84FF;
--accent-rgb: 10, 132, 255;
--accent-primary-hover: #3395FF;
--text-on-accent: #ffffff;
--border-color: #333333;
--bg-badge: #4338ca;
--text-badge: #eef2ff;
--timeline-indicator: #ef4444;
}
html {
    background-color: var(--bg-main);
    scroll-behavior: smooth;
}
body {
font-family: -apple-system, BlinkMacSystemFont, "Sarabun", "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
background-color: var(--bg-main);
color: var(--text-primary);
transition: background-color 0.3s ease, color 0.3s ease;
}
.schedule-card, .bg-card, .bg-alt, .toggle-bg, .badge, #question-input, button, .suggestion-pill {
transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
}
.schedule-card {
background-color: var(--bg-card);
box-shadow: 0 4px 12px rgba(0, 0, 0, 0.04);
transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out, background-color 0.3s ease;
}
.schedule-card:hover {
transform: translateY(-4px);
box-shadow: 0 10px 20px rgba(0, 0, 0, 0.07);
}
#chat-container {
scroll-behavior: smooth;
}
.chat-bubble {
animation: fadeIn 0.3s ease-out;
}
@keyframes fadeIn {
from { opacity: 0; transform: translateY(10px); }
to { opacity: 1; transform: translateY(0); }
}
/* Custom styles for new palette */
.text-primary { color: var(--text-primary); }
.text-secondary { color: var(--text-secondary); }
.bg-accent { background-color: var(--accent-primary); }
.hover\:bg-accent-hover:hover { background-color: var(--accent-primary-hover); }
.text-on-accent { color: var(--text-on-accent); }
.border-default { border-color: var(--border-color); }
.ring-accent:focus { --tw-ring-color: var(--accent-primary); }
.bg-alt { background-color: var(--bg-alt); }
#question-input::placeholder { color: var(--text-secondary); }
.badge { background-color: var(--bg-badge); color: var(--text-badge); }
/* Toggle Switch Styles */
    .toggle-bg {
         background-color: var(--bg-alt);
         transition: background-color 0.2s ease;
    }
    .toggle-dot {
        transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
    input:checked ~ .toggle-bg {
        background-color: var(--accent-primary);
    }
    input:checked + .toggle-bg { /* Direct sibling for editor toggles */
         background-color: var(--accent-primary);
    }
    input:checked + .toggle-bg + .toggle-dot {
         transform: translateX(1.25rem); /* 20px */
    }
    .peer:checked ~ .toggle-dot {
        transform: translateX(1.25rem); /* For settings toggles */
    }


    /* Suggestion Pill Styles */
    .suggestion-pill {
        background-color: var(--bg-alt);
        color: var(--text-secondary);
        font-size: 0.875rem;
        font-weight: 500;
        padding: 0.4rem 0.9rem;
        border-radius: 9999px;
        border: none;
        cursor: pointer;
    }
    .suggestion-pill:hover {
        background-color: var(--accent-primary);
        color: var(--text-on-accent);
    }
    
    /* View Toggle Styles */
    .view-toggle-btn { padding: 0.25rem 1rem; border-radius: 9999px; border: 2px solid transparent; outline: none; transition: all 0.2s ease-in-out; }
    .view-toggle-btn.active { background-color: var(--accent-primary); color: var(--text-on-accent); }
    .view-toggle-btn:not(.active) { color: var(--text-secondary); }
    .view-toggle-btn:not(.active):hover { background-color: rgba(var(--accent-rgb), 0.1); }
    
    /* Timeline Styles */
    #timeline-view {
        background-color: var(--bg-card);
        border-radius: 1rem;
        padding: 1.5rem;
        overflow-x: auto;
        /* For better touch scrolling on mobile */
        -webkit-overflow-scrolling: touch;
        touch-action: pan-x;
        position: relative;
    }
    /* Visual hint for horizontal scrolling */
    .scroll-hint-container.is-scrollable::after {
        content: '';
        position: absolute;
        right: 0;
        top: 0;
        bottom: 0;
        width: 50px;
        background: linear-gradient(to right, rgba(var(--bg-card-rgb), 0), var(--bg-card));
        pointer-events: none;
        transition: opacity 0.2s;
    }
    .dark .scroll-hint-container.is-scrollable::after {
        background: linear-gradient(to right, rgba(29, 29, 29, 0), rgb(29, 29, 29));
    }

    .timeline-container {
        position: relative;
        width: 100%;
        height: 140px; /* Slightly shorter for mobile */
    }
    .timeline-hours {
        display: flex;
        justify-content: space-between;
        color: var(--text-secondary);
        font-size: 0.75rem;
        padding-bottom: 0.5rem;
        border-bottom: 1px solid var(--border-color);
    }
    .timeline-grid {
        position: absolute;
        top: 2rem;
        left: 0;
        right: 0;
        bottom: 0;
        display: flex;
        justify-content: space-between;
    }
    .timeline-grid-line {
        width: 1px;
        background-color: rgba(var(--border-color-rgb, 209, 209, 214), 0.2);
    }
    .timeline-class-block {
        position: absolute;
        top: 2.5rem;
        height: 70px; /* Adjusted height */
        background-color: var(--accent-primary); /* Fallback */
        color: var(--text-on-accent);
        border-radius: 0.5rem;
        padding: 0.5rem;
        font-size: 0.85rem; /* Slightly larger font for mobile */
        font-weight: 500;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        justify-content: center;
        box-shadow: inset 0 1px 1px rgba(255,255,255,0.1), 0 4px 8px rgba(0,0,0,0.1);
        transition: all 0.2s ease;
        animation: popIn 0.4s ease-out forwards;
    }
    @keyframes popIn {
        from { opacity: 0; transform: scale(0.9); }
        to { opacity: 1; transform: scale(1); }
    }
    .timeline-class-block:hover {
        transform: scale(1.02);
        z-index: 10;
    }
    .timeline-class-subject {
        font-weight: 700;
    }
    .timeline-time-indicator {
        position: absolute;
        top: 2rem;
        bottom: 0;
        width: 2px;
        background-color: var(--timeline-indicator);
        z-index: 20;
        transition: left 1s linear;
    }
    .timeline-time-indicator::before {
        content: '';
        position: absolute;
        top: -5px;
        left: 50%;
        transform: translateX(-50%);
        width: 10px;
        height: 10px;
        border-radius: 50%;
        background-color: var(--timeline-indicator);
    }

    /* --- MOBILE-FIRST EDIT FORM STYLES --- */
    .edit-class-row {
        display: grid;
        gap: 0.75rem; /* 12px */
        grid-template-areas:
            "time subject"
            "time controls";
        grid-template-columns: auto 1fr;
        align-items: center;
    }
    .edit-class-row-time { grid-area: time; display: flex; flex-direction: column; gap: 0.5rem; align-items: center; }
    .edit-class-row-subject { grid-area: subject; display: flex; align-items: center; gap: 0.75rem; min-width: 0; }
    .edit-class-row-controls { grid-area: controls; display: flex; justify-content: space-between; align-items: center; }

    /* On larger screens, switch to a horizontal layout */
    @media (min-width: 640px) { /* Corresponds to sm: breakpoint */
        .edit-class-row {
            grid-template-areas: "time subject controls";
            grid-template-columns: auto 1fr auto;
            gap: 0.75rem;
        }
        .edit-class-row-time {
            flex-direction: row;
            gap: 0.5rem;
        }
        .edit-class-row-controls {
            gap: 1rem;
        }
    }
    
    /* Subject Color Picker Styles */
    .subject-color-picker {
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
        width: 28px;
        height: 28px;
        background-color: transparent;
        border: none;
        cursor: pointer;
        padding: 0;
        border-radius: 50%;
    }
    .subject-color-picker::-webkit-color-swatch {
        border-radius: 50%;
        border: 2px solid var(--border-color);
    }
    .subject-color-picker::-moz-color-swatch {
        border-radius: 50%;
        border: 2px solid var(--border-color);
    }
    
    /* --- TASK & SETTINGS MODAL STYLES --- */
    #task-modal-content, #settings-modal-content {
        transition-property: transform, opacity;
        transition-duration: 200ms;
        transition-timing-function: ease-out;
    }

    #task-modal.is-open #task-modal-content,
    #settings-modal.is-open #settings-modal-content {
        opacity: 1;
        transform: scale(1);
    }
    
    .task-badge {
        position: absolute;
        top: 0.75rem; /* 12px */
        right: 0.75rem; /* 12px */
        background-color: var(--timeline-indicator);
        color: white;
        font-size: 0.7rem;
        font-weight: 700;
        width: 1.25rem; /* 20px */
        height: 1.25rem; /* 20px */
        border-radius: 9999px;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 0 0 2px var(--bg-card);
    }

    .class-item-container {
        position: relative; /* For badge positioning */
        cursor: pointer;
        border-left: 4px solid transparent;
        padding-left: 1rem;
        transition: border-color 0.3s ease;
    }

    .task-item {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 0.75rem 0;
        border-bottom: 1px solid var(--border-color);
    }
    .task-item:last-child {
        border-bottom: none;
    }
    .task-item-checkbox {
        flex-shrink: 0;
        width: 1.25rem;
        height: 1.25rem;
        border-radius: 0.375rem;
        border: 2px solid var(--border-color);
        cursor: pointer;
        appearance: none;
        background-color: transparent;
        transition: background-color 0.2s, border-color 0.2s;
        position: relative;
    }
    .task-item-checkbox:checked {
        background-color: var(--accent-primary);
        border-color: var(--accent-primary);
    }
    .task-item-checkbox:checked::after {
        content: '✔';
        color: var(--text-on-accent);
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 0.8rem;
        font-weight: bold;
    }
    .task-item-text.is-completed {
        text-decoration: line-through;
        color: var(--text-secondary);
    }
    .task-delete-btn {
        margin-left: auto;
        color: var(--text-secondary);
        padding: 0.25rem;
        border-radius: 9999px;
    }
    .task-delete-btn:hover {
        color: #ef4444;
        background-color: rgba(239, 68, 68, 0.1);
    }
</style>
<link rel="stylesheet" href="/index.css">
</head>
<body class="antialiased">
<div id="app" class="max-w-6xl mx-auto p-4 sm:p-6 lg:p-8">
    
    <header class="text-center mb-8 sm:mb-12">
        <h1 class="text-3xl sm:text-4xl lg:text-5xl font-extrabold text-primary tracking-normal">ClassBuddy</h1>
        <p class="text-secondary mt-2 sm:mt-3 text-base sm:text-lg">Your intelligent class schedule assistant</p>
    </header>

    <main class="space-y-12">
        <!-- Q&A Section -->
        <section id="qa-section" class="relative z-10" aria-labelledby="qa-heading">
            <div class="bg-card rounded-2xl shadow-md p-4 sm:p-6">
                 <div class="flex justify-between items-center gap-y-3 mb-4 px-1">
                    <h2 id="qa-heading" class="text-lg font-bold text-primary">Chat with Buddy</h2>
                     <div class="flex items-center">
                         <button id="settings-btn" type="button" class="p-2 rounded-full text-secondary hover:bg-alt focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-accent" aria-label="Open settings">
                             <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                                 <path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                                 <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                             </svg>
                         </button>
                     </div>
                </div>
                <div id="chat-container" class="h-64 overflow-y-auto mb-4 p-3 sm:p-4 bg-main rounded-xl">
                     <!-- Chat messages will be appended here -->
                </div>
                <form id="qa-form" class="flex items-center gap-2 sm:gap-3">
                    <input type="text" id="question-input" placeholder="e.g., “First class tomorrow?”" class="flex-grow p-3 border border-default rounded-xl focus:ring-2 ring-accent focus:border-transparent transition w-full bg-alt placeholder:text-secondary" required autocomplete="off">
                    <button type="submit" class="bg-accent text-on-accent font-semibold py-3 px-4 sm:px-5 rounded-xl hover:bg-accent-hover transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 ring-accent flex-shrink-0">
                        Ask
                    </button>
                </form>
                <div id="chat-suggestions-container" class="flex flex-wrap items-center gap-2 mt-3 empty:mt-0">
                    <!-- Suggestion pills will be generated here -->
                </div>
            </div>
        </section>

        <!-- Schedule Section -->
        <section id="schedule-section" aria-labelledby="schedule-heading">
            <div class="flex flex-col sm:flex-row justify-between sm:items-center mb-6 gap-4">
                <h2 id="schedule-heading" class="text-2xl sm:text-3xl font-extrabold text-primary tracking-tight">Schedule</h2>
                 <div class="flex items-center gap-2 w-full sm:w-auto">
                    <div id="view-toggle-group" class="bg-alt p-1 rounded-full flex text-sm font-semibold flex-grow">
                        <button id="week-view-btn" class="view-toggle-btn active w-1/2">Week</button>
                        <button id="day-view-btn" class="view-toggle-btn w-1/2">Day</button>
                    </div>
                    <button id="edit-schedule-toggle" class="text-sm font-semibold py-2 px-4 rounded-lg border border-default text-secondary hover:bg-alt transition-colors sm:w-auto flex-shrink-0">
                        Edit
                    </button>
                </div>
            </div>

            <div id="schedule-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5">
                <!-- Schedule cards will be generated here -->
            </div>
            
            <div id="timeline-view" class="hidden scroll-hint-container">
                <!-- Timeline will be generated here -->
            </div>

            <div id="edit-schedule-form" class="hidden mt-8 p-4 sm:p-6 bg-card rounded-2xl border-default shadow-md">
                <h3 class="text-xl font-bold mb-2 text-primary">Edit Your Schedule</h3>
                <p class="text-sm text-secondary mb-6">Your schedule is saved automatically. Click the colored circle to change a subject's color.</p>
                <div class="space-y-4" id="schedule-inputs">
                    <!-- Dynamic inputs for schedule editing will be generated here -->
                </div>
                 <button id="add-class-btn" class="w-full mt-6 bg-accent/10 text-accent font-semibold py-2 px-4 rounded-lg hover:bg-accent/20 transition-colors">
                    + Add Class
                </button>
            </div>
        </section>
    </main>
    
</div>

<!-- Task Management Modal -->
<div id="task-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 z-40 flex items-center justify-center p-4" aria-modal="true" role="dialog">
    <div id="task-modal-content" class="bg-card w-full max-w-md rounded-2xl shadow-xl transform transition-all opacity-0 scale-95">
        <!-- Content will be injected by JS -->
    </div>
</div>

<!-- Settings Modal -->
<div id="settings-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 z-50 flex items-center justify-center p-4" aria-modal="true" role="dialog">
    <div id="settings-modal-content" class="bg-card w-full max-w-md rounded-2xl shadow-xl transform transition-all opacity-0 scale-95">
        <div class="p-5 sm:p-6">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold text-primary">Settings</h3>
                <button id="settings-modal-close-btn" class="p-2 -mr-2 -mt-2 rounded-full text-secondary hover:bg-alt" aria-label="Close">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
                </button>
            </div>

            <div class="space-y-6">
                <!-- Appearance Section -->
                <div>
                    <h4 class="text-md font-semibold text-primary mb-2">Appearance</h4>
                    <div class="flex items-center justify-between bg-alt p-3 rounded-lg">
                        <span class="font-medium text-primary">Dark Mode</span>
                        <label for="theme-toggle-switch" class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="theme-toggle-switch" class="sr-only peer">
                            <div class="toggle-bg block w-11 h-6 rounded-full"></div>
                            <div class="toggle-dot absolute left-0.5 top-0.5 bg-white w-5 h-5 rounded-full"></div>
                        </label>
                    </div>
                </div>

                <!-- Notifications Section -->
                <div>
                    <h4 class="text-md font-semibold text-primary mb-2">Notifications</h4>
                     <div class="flex items-center justify-between bg-alt p-3 rounded-lg">
                        <span class="font-medium text-primary">Class Reminders</span>
                         <label for="notifications-toggle-switch" class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="notifications-toggle-switch" class="sr-only peer">
                            <div id="notifications-toggle-bg" class="toggle-bg block w-11 h-6 rounded-full"></div>
                            <div class="toggle-dot absolute left-0.5 top-0.5 bg-white w-5 h-5 rounded-full"></div>
                        </label>
                    </div>
                    <p class="text-xs text-secondary mt-2 px-1">Get notified 10 minutes before a class starts. You may need to grant permission.</p>
                </div>

                <!-- Data Management Section -->
                <div>
                    <h4 class="text-md font-semibold text-primary mb-2">Data Management</h4>
                    <div class="space-y-2">
                         <button id="export-data-btn" class="w-full text-center bg-alt font-semibold py-2 px-4 rounded-lg text-primary hover:bg-border-default transition-colors">Export Schedule Data</button>
                         <button id="import-data-btn" class="w-full text-center bg-alt font-semibold py-2 px-4 rounded-lg text-primary hover:bg-border-default transition-colors">Import Schedule Data</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<footer class="text-center text-xs text-secondary mt-12 mb-6 space-y-1 px-4">
    <p>Version 1.5.3</p>
    <p>© <span id="current-year">2025</span> Wiqnnc_. All Rights Reserved.</p>
    <p>Made with love by Win.</p>
</footer>

<script type="module" src="index.tsx"></script>
<script type="module" src="/index.tsx"></script>
</body>
</html>